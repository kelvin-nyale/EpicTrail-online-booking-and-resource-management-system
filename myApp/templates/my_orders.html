{% extends "base.user.html" %}
{% block title %}My Orders{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4 text-primary fw-bold">My Orders</h2>
    <a href="{% url 'place_order' %}" class="btn btn-outline-success mb-4">
        <i class="bi bi-plus-circle me-1"></i> Place New Order
    </a>

    {% if orders %}
    <div class="row g-4">
        {% for order in orders %}
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 shadow-sm border-0 rounded-3 position-relative overflow-hidden" style="transition: transform 0.2s;">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-truncate" title="{{ order.foodOrder_food.food_name }}">
                        <i class="bi bi-basket-fill me-2 text-success"></i>
                        {{ order.foodOrder_food.food_name }}
                    </h5>
                    <p class="mb-1"><strong>Quantity:</strong> {{ order.foodOrder_quantity }}</p>
                    <p class="mb-1"><strong>Total:</strong> Ksh {{ order.total_price|floatformat:2 }}</p>
                    {% if order.foodOrder_check_in %}
                    <p class="mb-1"><strong>Check-In:</strong> {{ order.foodOrder_check_in|date:"M d, Y" }}</p>
                    {% endif %}

                    <p class="mb-2">
                        <strong>Status:</strong>
                        {% if order.foodOrder_status == "pending" %}
                            <span class="badge bg-warning text-dark">{{ order.foodOrder_status|title }}</span>
                        {% elif order.foodOrder_status == "completed" %}
                            <span class="badge bg-success">{{ order.foodOrder_status|title }}</span>
                        {% elif order.foodOrder_status == "cancelled" %}
                            <span class="badge bg-danger">{{ order.foodOrder_status|title }}</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ order.foodOrder_status|title }}</span>
                        {% endif %}
                    </p>

                    <div class="mt-auto d-flex flex-column gap-2">
                        {% if order.foodOrder_status == "pending" %}
                        <div class="d-flex gap-2">
                            <a href="{% url 'update_order' order.id %}" class="btn btn-sm btn-outline-warning flex-grow-1">
                                <i class="bi bi-pencil-square me-1"></i> Update
                            </a>
                            <a href="{% url 'cancel_order' order.id %}" class="btn btn-sm btn-outline-danger flex-grow-1">
                                <i class="bi bi-x-circle me-1"></i> Cancel
                            </a>
                        </div>
                        {% endif %}

                        <!-- Print Receipt Button -->
                        <a href="{% url 'download_order_receipt' order.id %}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">
                            <i class="bi bi-printer-fill me-1"></i> Print Receipt
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info mt-4" role="alert">
        You have no orders yet. Click <a href="{% url 'place_order' %}" class="alert-link">here</a> to place one.
    </div>
    {% endif %}
</div>

<!-- Card hover effect -->
<style>
.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
}
</style>
{% endblock %}
