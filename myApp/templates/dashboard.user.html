{% extends 'base.user.html' %}
{% block title %}User Dashboard{% endblock %}

{% block content %}

<div class="mb-4">
    <h4 class="fw-bold">Welcome, {{ user.username }}</h4>
    <p class="text-muted">Hereâ€™s an overview of your activities.</p>
</div>

<!-- Overview Cards -->
<div class="row mb-4">
    <div class="col-md-4 g-2">
        <div class="card shadow-sm border-0 rounded-4">
            <div class="card-body text-center">
                <h5 class="text-muted">My Bookings</h5>
                <h2 class="fw-bold text-success">{{ total_bookings }}</h2>
            </div>
        </div>
    </div>

    <div class="col-md-4 g-2">
        <div class="card shadow-sm border-0 rounded-4">
            <div class="card-body text-center">
                <h5 class="text-muted">Available Services</h5>
                <h2 class="fw-bold">{{ total_services }}</h2>
            </div>
        </div>
    </div>

    <div class="col-md-4 g-2">
        <div class="card shadow-sm border-0 rounded-4">
            <div class="card-body text-center">
                <h5 class="text-muted">Notifications</h5>
                <h2 class="fw-bold text-primary">{{ total_notifications }}</h2>
            </div>
        </div>
    </div>
</div>

<!-- Recent Bookings Table -->
<div class="card mb-4 shadow-sm border-0 rounded-4">
    <div class="card-header bg-success text-white rounded-top-4">
        Recent Bookings & Orders
    </div>

    <div class="card-body">
        {% if recent_bookings %}
        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Services</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>

                <tbody>
                    {% for booking in recent_bookings %}
                    <tr>
                        <td>{{ forloop.counter }}</td>

                        <td>
                            {% if booking.booking_activities.exists %}
                                {{ booking.booking_activities.all|join:", " }}
                            {% elif booking.booking_packages.exists %}
                                {{ booking.booking_packages.all|join:", " }}
                            {% elif booking.booking_tours.exists %}
                                {{ booking.booking_tours.all|join:", " }}
                            {% else %}
                                <span class="text-muted">N/A</span>
                            {% endif %}
                        </td>

                        <td>{{ booking.booking_check_in|date:"M d, Y" }}</td>

                        <td>
                            {% if booking.status == "confirmed" %}
                                <span class="badge bg-success">Confirmed</span>
                            {% elif booking.status == "pending" %}
                                <span class="badge bg-warning">Pending</span>
                            {% else %}
                                <span class="badge bg-secondary">{{ booking.status }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <a href="{% url 'booking_list' %}" class="btn btn-success mt-3">
            View All Bookings
        </a>

        {% else %}
        <p class="text-muted">No recent bookings found.</p>
        <a href="{% url 'create_booking' %}" class="btn btn-primary">Make Your First Booking</a>
        {% endif %}
    </div>
</div>

<!-- Quick Actions -->
<div class="d-flex flex-wrap gap-3">
    <a href="{% url 'create_booking' %}" class="btn btn-outline-success">
        Book a Service
    </a>

    <a href="{% url 'explore' %}" class="btn btn-outline-primary">
        Explore Services
    </a>

    <a href="{% url 'update_profile' %}" class="btn btn-outline-dark">
        Edit Profile
    </a>
</div>

{% endblock %}
